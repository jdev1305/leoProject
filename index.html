<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>R.H.V.Leonidas H13 - Goals Tracker 25/26</title>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  body { 
    font-family: Arial, sans-serif; 
    background: #111; 
    color: #f0f0f0; 
    margin: 20px; 
  }
  h1 { text-align: center; margin-bottom: 20px; }
  .chart-container { display: flex; justify-content: center; margin-bottom: 30px; }
  canvas { 
    max-width: 700px; 
    width: 90%; 
    background: #222; 
    padding: 15px; 
    border-radius: 15px; 
    box-shadow: 0 4px 12px rgba(0,0,0,0.6);
  }
  .week-header { 
    margin: 25px auto 10px; 
    font-size: 1.3em; 
    font-weight: bold; 
    background: #007bff; 
    display: inline-block; 
    padding: 6px 14px; 
    border-radius: 20px; 
    box-shadow: 0 2px 6px rgba(0,0,0,0.5);
  }
  table { 
    width: 95%; 
    max-width: 700px; 
    margin: 10px auto; 
    border-collapse: collapse; 
    background: #1e1e1e; 
    border-radius: 10px; 
    overflow: hidden; 
    box-shadow: 0 4px 10px rgba(0,0,0,0.6);
  }
  th, td { border-bottom: 1px solid #333; padding: 10px; text-align: center; }
  th { background: #007bff; color: #fff; font-size: 1.05em; }
  td input { padding: 5px; border-radius: 6px; border: none; background: #333; color: #fff; }
  .action-btn { 
    border: none; border-radius: 6px; 
    padding: 12px 20px; font-size: 1.1em; 
    margin: 2px; cursor: pointer; 
    color: #fff; font-weight: bold;
    transition: transform 0.15s ease, background 0.2s ease;
  }
  .action-btn:hover { transform: scale(1.08); }
  .action-btn.add { background: #28a745; }
  .action-btn.minus { background: #ff9800; }
  .action-btn.remove { background: #dc3545; }
  .add-player-container { 
    display: flex; justify-content: center; gap: 10px; margin-top: 10px; 
  }
  .add-player-container input { flex: 1; }
  .add-player-container button { 
    background: #007bff; color: #fff; border: none; 
    padding: 10px 18px; border-radius: 8px; cursor: pointer; font-weight: bold;
  }
  .add-player-container button:hover { background: #0056b3; }
</style>
</head>
<body>
<h1>R.H.V.Leonidas H13 - Goals Tracker 25/26</h1>

<div class="chart-container">
  <canvas id="totalGoalsChart"></canvas>
</div>

<div id="results"></div>

<script>
  // --- Firebase config ---
  const firebaseConfig = {
    apiKey: "AIzaSyCjNY4jonCkxLhdS9MQCg382l2y6pmPOc4",
    authDomain: "leonidasgoalstracker.firebaseapp.com",
    databaseURL: "https://leonidasgoalstracker-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "leonidasgoalstracker",
    storageBucket: "leonidasgoalstracker.appspot.com",
    messagingSenderId: "351370021203",
    appId: "1:351370021203:web:8d0ca697abc1646d4079a6",
    measurementId: "G-59JJEDNL8E"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const resultsDiv = document.getElementById("results");
  let chart;

  const goalsRef = db.ref('goals');

  // Ensure weeks exist
  goalsRef.once('value').then(snapshot => {
    let data = snapshot.val() || {};
    for (let i=1; i<=10; i++) {
      if (!data[`Week${i}`]) data[`Week${i}`] = {};
    }
    goalsRef.set(data, () => {
      goalsRef.on('value', snap => {
        const data = snap.val() || {};
        renderAll(data);
      });
    });
  });

  function renderAll(data){
    renderTables(data);
    renderChart(data);
  }

  function renderTables(data){
    resultsDiv.innerHTML = '';
    for (let i=1; i<=10; i++){
      const weekKey = `Week${i}`;
      const weekData = data[weekKey] || {};
      let tableHTML = `<div class="week-header">Week ${i}</div>
      <table><tr><th>Player</th><th>Goals</th><th>Actions</th><th>Opponent</th></tr>`;
      
      let opponentName = weekData["_opponent"] || "";

      for (const player in weekData){
        if (player === "_opponent") continue;
        tableHTML += `<tr>
          <td><b>${player}</b></td>
          <td>${weekData[player]}</td>
          <td>
            <button class="action-btn add" onclick="changeGoals('${weekKey}','${player}',1)">+1</button>
            <button class="action-btn minus" onclick="changeGoals('${weekKey}','${player}',-1)">-1</button>
            <button class="action-btn remove" onclick="removePlayer('${weekKey}','${player}')">X</button>
          </td>
          <td rowspan="100">
            <input type="text" value="${opponentName}" 
              onchange="saveOpponent('${weekKey}', this.value)" 
              placeholder="Opponent">
          </td>
        </tr>`;
      }

      tableHTML += `<tr><td colspan="4">
        <div class="add-player-container">
          <input type="text" id="input-${weekKey}" placeholder="Player name">
          <button onclick="addPlayer('${weekKey}')">Add Player</button>
        </div>
      </td></tr></table>`;

      resultsDiv.innerHTML += tableHTML;
    }
  }

  function renderChart(data){
    const totals = {};
    for (let i=1; i<=10; i++){
      const weekKey = `Week${i}`;
      const weekData = data[weekKey] || {};
      for (const player in weekData){
        if (player === "_opponent") continue;
        totals[player] = (totals[player]||0)+weekData[player];
      }
    }

    const labels = Object.keys(totals);
    const values = Object.values(totals);

    const ctx = document.getElementById('totalGoalsChart').getContext('2d');
    if(chart) chart.destroy();
    chart = new Chart(ctx,{
      type:'bar',
      data:{
        labels,
        datasets:[{
          label:'Total Goals',
          data:values,
          backgroundColor: labels.map((_,i)=>`hsl(${i*40},70%,50%)`),
          borderRadius:6,
          barPercentage:0.7,
          categoryPercentage:0.8
        }]
      },
      options:{
        indexAxis:'y',
        responsive:true,
        plugins:{legend:{display:false}},
        scales:{
          x:{beginAtZero:true, ticks:{precision:0}, grid:{color:'#444'}},
          y:{grid:{color:'#333'}, ticks:{font:{size:18, weight:'bold'}}}
        }
      }
    });
  }

  function changeGoals(week,player,delta){
    const ref = db.ref(`goals/${week}/${player}`);
    ref.transaction(curr => {
      return (curr||0)+delta > 0 ? (curr||0)+delta : 0;
    });
  }
  function removePlayer(week,player){
    db.ref(`goals/${week}/${player}`).remove();
  }
  function addPlayer(week){
    const input = document.getElementById(`input-${week}`);
    const player = input.value.trim();
    if(player){
      db.ref(`goals/${week}/${player}`).set(0);
      input.value='';
    }
  }
  function saveOpponent(week,value){
    db.ref(`goals/${week}/_opponent`).set(value);
  }
</script>
</body>
</html>
